* Emacså’ŒUTF-8

*åœ¨Emacså†…éƒ¨æ‰€æœ‰çš„æ–‡æœ¬éƒ½ç”¨UTF-8æ ¼å¼å­˜å‚¨* ï¼Œè¿™æ˜¯ä¸ªéå¸¸æ˜æ™ºçš„é€‰æ‹©ï¼å½“Emacsè¾“å‡ºæ–‡æœ¬ï¼Œæ¯”å¦‚å†™åˆ°æ–‡ä»¶æˆ–è€…ä¼ åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼ŒEmacsä¼šè‡ªåŠ¨æ ¹æ®æ–‡ä»¶æˆ–è¿›ç¨‹æ‰€é…ç½®çš„ç¼–ç ç³»ç»Ÿæ¥å¯¹æ–‡æœ¬è¿›è¡Œç¼–ç ã€‚å½“è¯»å–ä¸€ä¸ªæ–‡ä»¶æˆ–è€…è¿›ç¨‹çš„æ–‡æœ¬æ—¶ï¼ŒEmacsè¦ä¹ˆå®ƒå°†å…¶è½¬æ¢ä¸ºUTF-8ç¼–ç æ ¼å¼ï¼Œè¦ä¹ˆä¿æŒåŸå§‹å­—èŠ‚ã€‚

å…³äºè¿™ç‚¹åœ¨Emacsä¸­æœ‰2ç§æ¨¡å¼ï¼šå•å­—èŠ‚å’Œå¤šå­—èŠ‚ã€‚å•å­—èŠ‚strings/bufferså°±æ˜¯åŸå§‹å­—èŠ‚ï¼Œå®ƒä»¬æ»¡è¶³å¸¸é‡æ—¶é—´O(1)è®¿é—®ä½†æ˜¯è¿›èƒ½ä¿å­˜å•å­—èŠ‚å€¼[[http://nullprogram.com/blog/2014/01/04/][byte-code compiler outputs unibyte strings]]ã€‚

å¤šå­—èŠ‚strings/buffersä¿å­˜UTF-8ç¼–ç çš„ç¼–ç å€¼ã€‚å­—ç¬¦è®¿é—®æ—¶é—´å¤æ‚è¯»æ˜¯O(n)å› ä¸ºéœ€è¦éå†ä¸€è¾¹string/bufferæ¥è®¡ç®—å­—ç¬¦ä¸ªæ•°ã€‚

å®é™…çš„ç¼–ç å¾ˆå°‘å…³å¿ƒï¼Œå› ä¸ºæ²¡æœ‰å¤ªå¤šæ–¹æ³•ï¼ˆå’Œéœ€è¦ï¼‰æ¥ç›´æ¥è®¿é—®ã€‚å½“æ–‡æœ¬è¾“å…¥æˆ–è¾“å‡ºæ—¶ï¼ŒEmacsä¼šè‡ªåŠ¨å°†æ–‡æœ¬ç¼–ç æ ¼å¼æŒ‰éœ€è¿›è¡Œè½¬æ¢ï¼Œæ‰€ä»¥ä¸éœ€è¦å…³å¿ƒå†…éƒ¨çš„ç¼–ç ã€‚å¦‚æœä½  /ç¡®å®/ æƒ³çŸ¥é“ï¼Œä½ å¯ä»¥ç”¨string-as-unibyteæ¥å¾—åˆ°ä»¥å­—èŠ‚è¡¨ç¤ºçš„stringã€‚

#+BEGIN_SRC emacs-lisp
  (string-as-unibyte "Ï€")
  ;; => "\317\200"
#+END_SRC

This can be reversed with string-as-multibyte), to change a unibyte string
holding UTF-8 encoded text back into a multibyte string. Note that these
functions are different than string-to-unibyte and string-to-multibyte, which
will attempt a conversion rather than preserving the raw bytes.

The length and buffer-size functions always count characters in multibyte and
bytes in unibyte. Being UTF-8, there are no surrogate pairs to worry about
here. The string-bytes and position-bytes functions return byte information
for both multibyte and unibyte.

To specify a Unicode character in a string literal without using the character
directly, use \uXXXX. The XXXX is the hexadecimal code point for the character
and is always 4 digits long. For characters outside the BMP, which wonâ€™t fit
in four digits, use a capital U with eight digits: \UXXXXXXXX.

#+BEGIN_SRC emacs-lisp
  "\u03C0"
  ;; => "Ï€"

  "\U0001F4A9"
  ;; => "ğŸ’©"  (PILE OF POO)
#+END_SRC

Finally, Emacs extends Unicode with 256 additional â€œcharactersâ€ representing
raw bytes. This allows raw bytes to be embedded distinctly within UTF-8
sequences. For example, itâ€™s used to distinguish the code point U+0041 from
the raw byte #x41. As far as I can tell, this isnâ€™t used very often.
